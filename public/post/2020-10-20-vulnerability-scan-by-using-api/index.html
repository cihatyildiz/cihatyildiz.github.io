<!DOCTYPE html>


<html lang="en-us" data-theme="">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>Nexpose Vulnerability Scan by Using Rest-API - Cihat Yildiz</title>

<meta name="description" content="Vulnerability scan tools you identify vulnerabilities in your infrastructure. You can perform manual and automated scans. But, in some cases, you may need to integrate your scannner with another tool such as devops pipeline (jenkins) or VM build pipeline.">



<link rel="icon" type="image/x-icon" href="https://www.cihatyildiz.com/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://www.cihatyildiz.com/favicon.png">



    





    
    
        
    
    

    
        <link rel="stylesheet" href="https://www.cihatyildiz.com/css/style.min.0a537f3bb0e983fac9fdd9ab89517b7c25e24c3e34d140b76e8ae7a11ab74cb1.css" integrity="sha256-ClN/O7Dpg/rJ/dmriVF7fCXiTD400UC3bornoRq3TLE=">
    





    

    





    
    
        
    
    

    
        <script src="https://www.cihatyildiz.com/js/script.min.a65afe903825231554d9b55b073eb144da4ccf2d2823b216dcbc6cc656c9de76.js" type="text/javascript" charset="utf-8" integrity="sha256-plr&#43;kDglIxVU2bVbBz6xRNpMzy0oI7IW3LxsxlbJ3nY="></script>
    







<meta property="og:title" content="Nexpose Vulnerability Scan by Using Rest-API" />
<meta property="og:description" content="Vulnerability scan tools you identify vulnerabilities in your infrastructure. You can perform manual and automated scans. But, in some cases, you may need to integrate your scannner with another tool such as devops pipeline (jenkins) or VM build pipeline." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.cihatyildiz.com/post/2020-10-20-vulnerability-scan-by-using-api/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-10-20T20:55:00+08:00" />
<meta property="article:modified_time" content="2020-10-20T20:55:00+08:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Nexpose Vulnerability Scan by Using Rest-API"/>
<meta name="twitter:description" content="Vulnerability scan tools you identify vulnerabilities in your infrastructure. You can perform manual and automated scans. But, in some cases, you may need to integrate your scannner with another tool such as devops pipeline (jenkins) or VM build pipeline."/>











    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header"> 
            
                <div class="header-top">
    <h1 class="site-title">
        <a href="/"><strong>Cihat Yildiz</strong></a>
    </h1>
    <ul class="social-icons">


    
        <li>
            <a href="https://twitter.com/cihatix" title="Twitter" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

</span>

            </a>
        </li>
    

    
        <li>
            <a href="https://www.linkedin.com/in/cihatyildiz/" title="Linkedin" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

</span>

            </a>
        </li>
    

    
        <li>
            <a href="https://github.com/mitrichius/hugo-theme-anubis" title="Github" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

</span>

            </a>
        </li>
    



    
    <li>
        <a href="/index.xml" title="RSS" rel="me">
        <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg>

</span>

        </a>
    </li>


</ul>
</div>

    <nav>
        
        
        <a class="" href="https://www.cihatyildiz.com/about/" title="">About</a>
        
        <a class="" href="https://www.cihatyildiz.com/projects/" title="">Projects</a>
        
        <a class="" href="https://www.cihatyildiz.com/trainings/" title="">Trainings</a>
        
        <a class="" href="https://www.cihatyildiz.com/posts/" title="">Archive</a>
        
        <a class="" href="https://www.cihatyildiz.com/tags/" title="">Tags</a>
        
    </nav>




            
        </header>
        <main id="main" tabindex="-1"> 
            
    

    <article class="post h-entry">
        <div class="post-header">
            <header>
                <h1 class="p-name post-title">Nexpose Vulnerability Scan by Using Rest-API</h1>

                
            </header>
        </div>
        <div class="content e-content">
            <p>Vulnerability scan tools you identify vulnerabilities in your infrastructure. You can perform manual and automated scans. But, in some cases, you may need to integrate your scannner with another tool such as devops pipeline (jenkins) or VM build pipeline.</p>
<p>You cannot use automated scans in this type of integgrations. For example, lets say that you have build pipeline to generate a new virtual machine (VM). You can create number of macihnes in a day by usinng this pipeline. After build process, you need check that the asset doesn&rsquo;t have any high and critical vulnerabilities. So your deployment process should be blocked if there is any high or critical vulnerability on assets.</p>
<p><img src="/assets/img/sample/nexpose-pro_logo.jpg" alt="upload-image"></p>
<p>In this post, I want to give you a working example that shows how to initiate a scan using nexpose api. I will create a python script for this.  Rapid7 have a nice documentation about nexpose api. For any kind of automation with nexpose, tihs is the best resource.</p>
<h1 id="prepare-nexpose-infrastructure" >Prepare Nexpose Infrastructure
<span>
    <a href="#prepare-nexpose-infrastructure">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h1><p>Before to start script, we need to make some changes on Nexpose. I am not gonna explain details here. But I I did the below changes.</p>
<ul>
<li>Create a site in nexpose</li>
<li>Set default scan template for the site</li>
<li>Create an account for API. The account should be able to initiate scan on the site.</li>
</ul>
<p>In my nexpose configuration each site have has been created for different purposes. I think I should create another site for the API scan. But you can use existing sites in your infrastructure.</p>
<h1 id="manunal-test" >Manunal Test
<span>
    <a href="#manunal-test">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h1><p>Now we can start coding. My code have two basic steps</p>
<ol>
<li>Add the asset you want to scan into the site</li>
<li>Initiate the nexpose scan on the site</li>
</ol>
<h2 id="1-add-assets-you-wannt-to-scan" >1: Add assets you wannt to scan
<span>
    <a href="#1-add-assets-you-wannt-to-scan">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h2><p>This step is important. Before initiate a scan, we need to update the asset list on the site. Because, nexpose will use the asset list of the site. To add asset list into the site I use the below API call.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl --request PUT <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --url https://NexposeServer/api/3/sites/&lt;site-id&gt;/included_targets <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Authorization: &lt;auth-key&gt;&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --data <span style="color:#e6db74">&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&#34;10.99.55.129&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&#34;172.16.13.45&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]&#39;</span>
</span></span></code></pre></div><h2 id="3-start-the-scan" >3: Start the scan
<span>
    <a href="#3-start-the-scan">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h2><p>The API call to initiate is simple.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl --request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --url https://nexpose:3780/api/3/sites/&lt;site-id&gt;/scans <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Authorization: &lt;auth-key&gt;&#39;</span>
</span></span></code></pre></div><h2 id="4-check-if-scan-completed" >4: Check if scan completed
<span>
    <a href="#4-check-if-scan-completed">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h2><p>When you initiate a scan successfully, the server will provide the scan id number as a result. So you can use this number to check if scan is completed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl --request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --url https://NexposeServer/api/3/scans/73341 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Authorization: &lt;auth-key&gt;&#39;</span>
</span></span></code></pre></div><h2 id="5-get-asset-vulnerabilities" >5: Get Asset Vulnerabilities
<span>
    <a href="#5-get-asset-vulnerabilities">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h2><p>After the scan is completed, you can pull the vulnerability inforation from nexpose. it is a simple process. But there is two steps. We need to get asset id first, then we can get the findings by using asset id in the request.
You will need to use pagination to get all findings about the asset. But I did not use pagination in my code here.</p>
<p>Here is the query to get asset id:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl --request POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --url https://NexposeServer/api/3/assets/search <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Authorization: &lt;auth-key&gt;&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --data <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&#34;filters&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;field&#34;: &#34;ip-address&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;operator&#34;: &#34;is&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			&#34;value&#34;: &#34;10.99.55.129&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&#34;match&#34;: &#34;all&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span></code></pre></div><p>The request to get findings:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl --request GET <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --url <span style="color:#e6db74">&#39;https://NexposeServer/api/3/assets/&lt;asset-id&gt;/vulnerabilities?page=0&amp;size=500&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Authorization: &lt;auth-key&gt;&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span>
</span></span></code></pre></div><h1 id="the-script" >The Script
<span>
    <a href="#the-script">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h1><p>By using the requests above, I created two scripts. One for to initiate and one for to get scan results</p>
<p>This is the scripts to initiate a scan:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sys<span style="color:#f92672">,</span> os<span style="color:#f92672">,</span> re<span style="color:#f92672">,</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests.packages.urllib3
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> requests.auth <span style="color:#f92672">import</span> HTTPBasicAuth
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>requests<span style="color:#f92672">.</span>packages<span style="color:#f92672">.</span>urllib3<span style="color:#f92672">.</span>disable_warnings()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nexpose_username <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;NEXPOSE_USERNAME&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>nexpose_password <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;NEXPOSE_PASSWORD&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nexpose_asset_group_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">332</span>
</span></span><span style="display:flex;"><span>nexpose_db_scan_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nexpose&#34;</span> <span style="color:#75715e"># not required</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">addIpToNexposeSite</span>(ip_address):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;addIpToNexposeSite&#34;</span>)
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> ip_address
</span></span><span style="display:flex;"><span>    print(ip_address)
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://NexposeServer/api/3/sites/&#34;</span> <span style="color:#f92672">+</span> str(nexpose_asset_group_id) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/included_targets&#34;</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>put(
</span></span><span style="display:flex;"><span>        url,
</span></span><span style="display:flex;"><span>        headers<span style="color:#f92672">=</span>headers ,
</span></span><span style="display:flex;"><span>        auth<span style="color:#f92672">=</span>HTTPBasicAuth(nexpose_username, nexpose_password),
</span></span><span style="display:flex;"><span>        data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload),
</span></span><span style="display:flex;"><span>        verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;ASSET NOT EXIST!!&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getNexposeScanStatus</span>(scan_id):
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://NexposeServer/api/3/scans/&#34;</span> <span style="color:#f92672">+</span> str(scan_id)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(
</span></span><span style="display:flex;"><span>        url,
</span></span><span style="display:flex;"><span>        headers<span style="color:#f92672">=</span>headers ,
</span></span><span style="display:flex;"><span>        auth<span style="color:#f92672">=</span>HTTPBasicAuth(nexpose_username, nexpose_password),
</span></span><span style="display:flex;"><span>        verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;ERROR - get_scan_status&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    scan_status <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;status&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> scan_status
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">startNexposeScan</span>(assets):
</span></span><span style="display:flex;"><span>    ip_addresses <span style="color:#f92672">=</span> assets
</span></span><span style="display:flex;"><span>    scan_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    print(ip_addresses)
</span></span><span style="display:flex;"><span>    addIpToNexposeSite(ip_addresses)
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://NexposeServer/api/3/sites/&#34;</span> <span style="color:#f92672">+</span> str(nexpose_asset_group_id) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/scans&#34;</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(
</span></span><span style="display:flex;"><span>        url, headers<span style="color:#f92672">=</span>headers ,
</span></span><span style="display:flex;"><span>        auth<span style="color:#f92672">=</span>HTTPBasicAuth(nexpose_username, nexpose_password),
</span></span><span style="display:flex;"><span>        verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">201</span>:
</span></span><span style="display:flex;"><span>        print(response<span style="color:#f92672">.</span>status_code)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;SCAN DID NOT INITIATED!!&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    scan_id <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;id&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> str(scan_id)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ips <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>    startNexposeScan(ips)
</span></span></code></pre></div><p>This is the script to get findings</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sys<span style="color:#f92672">,</span> os<span style="color:#f92672">,</span> re<span style="color:#f92672">,</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests.packages.urllib3
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> requests.auth <span style="color:#f92672">import</span> HTTPBasicAuth
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>requests<span style="color:#f92672">.</span>packages<span style="color:#f92672">.</span>urllib3<span style="color:#f92672">.</span>disable_warnings()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nexpose_username <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;NEXPOSE_USERNAME&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>nexpose_password <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;NEXPOSE_PASSWORD&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getVulnDetails</span>(vuln_id):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://NexposeServer/api/3/vulnerabilities/&#34;</span> <span style="color:#f92672">+</span> str(vuln_id)
</span></span><span style="display:flex;"><span>        headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(
</span></span><span style="display:flex;"><span>            url,
</span></span><span style="display:flex;"><span>            headers<span style="color:#f92672">=</span>headers ,
</span></span><span style="display:flex;"><span>            auth<span style="color:#f92672">=</span>HTTPBasicAuth(nexpose_username, nexpose_password),
</span></span><span style="display:flex;"><span>            verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;ERROR - getVulnDetails&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#39;Exception - getVulnDetails()&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getNexposeAssetID</span>(ip_address):
</span></span><span style="display:flex;"><span>    print(ip_address)
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;filters&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;ip-address&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;operator&#34;</span>: <span style="color:#e6db74">&#34;is&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;value&#34;</span>: ip_address
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;match&#34;</span>: <span style="color:#e6db74">&#34;all&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://NexposeServer/api/3/assets/search&#34;</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(
</span></span><span style="display:flex;"><span>        url,
</span></span><span style="display:flex;"><span>        headers<span style="color:#f92672">=</span>headers,
</span></span><span style="display:flex;"><span>        auth<span style="color:#f92672">=</span>HTTPBasicAuth(nexpose_username,
</span></span><span style="display:flex;"><span>        nexpose_password),
</span></span><span style="display:flex;"><span>        data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload),
</span></span><span style="display:flex;"><span>        verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(str(response<span style="color:#f92672">.</span>status_code))
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;ASSET NOT EXIST!! T&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            aid <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;resources&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;id&#39;</span>]
</span></span><span style="display:flex;"><span>            print(aid)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> aid
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;No asset found&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>(<span style="color:#e6db74">&#34;No asset found&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getNexposeVulns</span>(asset_id):
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://NexposeServer/api/3/assets/&#34;</span> <span style="color:#f92672">+</span> str(asset_id) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/vulnerabilities?page=0&amp;size=500&#34;</span>
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(
</span></span><span style="display:flex;"><span>        url,
</span></span><span style="display:flex;"><span>        headers<span style="color:#f92672">=</span>headers ,
</span></span><span style="display:flex;"><span>        auth<span style="color:#f92672">=</span>HTTPBasicAuth(nexpose_username, nexpose_password),
</span></span><span style="display:flex;"><span>        verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;ERROR: getNexposeVulns&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getFormattedVuln</span>(vuln, ip_address, assetId):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># print(vuln)</span>
</span></span><span style="display:flex;"><span>    vulnDetails <span style="color:#f92672">=</span> getVulnDetails(vuln[<span style="color:#e6db74">&#39;id&#39;</span>])
</span></span><span style="display:flex;"><span>    formattedVuln <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;appId&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;assetId&#39;</span>] <span style="color:#f92672">=</span> assetId
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;title&#39;</span>] <span style="color:#f92672">=</span> vulnDetails[<span style="color:#e6db74">&#39;title&#39;</span>]
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;srcTool&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;nexpose&#39;</span>
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;srcToolId&#39;</span>] <span style="color:#f92672">=</span> vuln[<span style="color:#e6db74">&#39;id&#39;</span>]
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;status&#39;</span>] <span style="color:#f92672">=</span> vuln[<span style="color:#e6db74">&#39;status&#39;</span>]
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;severity&#39;</span>] <span style="color:#f92672">=</span> formatVulnImpact(vulnDetails[<span style="color:#e6db74">&#39;cvss&#39;</span>][<span style="color:#e6db74">&#39;v2&#39;</span>][<span style="color:#e6db74">&#39;score&#39;</span>])
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;details&#39;</span>] <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        formattedVuln[<span style="color:#e6db74">&#39;details&#39;</span>][<span style="color:#e6db74">&#39;info&#39;</span>] <span style="color:#f92672">=</span> vulnDetails[<span style="color:#e6db74">&#39;description&#39;</span>][<span style="color:#e6db74">&#39;html&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> formattedVuln
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#39;Exception: getFormattedVuln&#39;</span>)
</span></span><span style="display:flex;"><span>        print (e)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">formatVulnImpact</span>(impact):
</span></span><span style="display:flex;"><span>    formattedImpact <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;info&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> impact <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3.4</span>:
</span></span><span style="display:flex;"><span>        formattedImpact <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;low&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> (impact <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">6.7</span> <span style="color:#f92672">and</span> impact <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3.4</span> ):
</span></span><span style="display:flex;"><span>        formattedImpact <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;medium&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> (impact <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">and</span> impact <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">6.7</span> ):
</span></span><span style="display:flex;"><span>        formattedImpact <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;high&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> impact <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">9</span> :
</span></span><span style="display:flex;"><span>        formattedImpact <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;critical&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> formattedImpact
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">printVulnerabilitiesOnCLI</span>(vuln):
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Title&#34;</span> : vuln[<span style="color:#e6db74">&#39;title&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ID&#34;</span> : vuln[<span style="color:#e6db74">&#39;srcToolId&#39;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    ip <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    asset_id <span style="color:#f92672">=</span> getNexposeAssetID(ip)
</span></span><span style="display:flex;"><span>    raw_vulns <span style="color:#f92672">=</span> getNexposeVulns(asset_id)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> vuln <span style="color:#f92672">in</span> raw_vulns[<span style="color:#e6db74">&#39;resources&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> vuln[<span style="color:#e6db74">&#39;status&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;vulnerable&#34;</span>:
</span></span><span style="display:flex;"><span>                prep_vuln <span style="color:#f92672">=</span> getFormattedVuln(vuln, ip, asset_id)
</span></span><span style="display:flex;"><span>                printVulnerabilitiesOnCLI(prep_vuln)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;Exception in scan()&#39;</span>)
</span></span><span style="display:flex;"><span>        print(e)
</span></span></code></pre></div><p>Here is the command line output of the scripts above:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>user@rhost<span style="color:#f92672">]</span>$ python3 nexposeResults.py 10.99.55.129
</span></span><span style="display:flex;"><span>10.99.55.129
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">806026</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;IBM Java: Oracle July 14 2020 CPU (CVE-2020-14556)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;ibm-java-cve-2020-14556&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;IBM Java: Oracle July 14 2020 CPU (CVE-2020-14577)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;ibm-java-cve-2020-14577&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;IBM Java: Oracle July 14 2020 CPU (CVE-2020-14578)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;ibm-java-cve-2020-14578&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;IBM Java: Oracle July 14 2020 CPU (CVE-2020-14579)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;ibm-java-cve-2020-14579&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;IBM Java: Oracle July 14 2020 CPU (CVE-2020-14583)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;ibm-java-cve-2020-14583&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;IBM Java: Oracle July 14 2020 CPU (CVE-2020-14593)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;ibm-java-cve-2020-14593&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;IBM Java: Oracle July 14 2020 CPU (CVE-2020-14621)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;ibm-java-cve-2020-14621&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU October 2017 Java SE, Java SE Embedded, JRockit vulnerability (CVE-2016-10165)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-10165&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU January 2017 Java SE, Java SE Embedded Libraries vulnerability (CVE-2016-2183)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-2183&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU January 2017 Java SE, Java SE Embedded, JRockit Libraries vulnerability (CVE-2016-5546)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-5546&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU January 2017 Java SE, Java SE Embedded, JRockit Libraries vulnerability (CVE-2016-5547)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-5547&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU January 2017 Java SE, Java SE Embedded Libraries vulnerability (CVE-2016-5548)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-5548&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU January 2017 Java SE, Java SE Embedded Libraries vulnerability (CVE-2016-5549)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-5549&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU January 2017 Java SE, Java SE Embedded, JRockit Networking vulnerability (CVE-2016-5552)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-5552&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU January 2017 Java SE Java Mission Control vulnerability (CVE-2016-8328)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-8328&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU October 2017 Java SE, Java SE Embedded vulnerability (CVE-2016-9841)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2016-9841&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU July 2017 Java SE, Java SE Embedded, JRockit vulnerability (CVE-2017-10053)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2017-10053&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU July 2017 Java SE vulnerability (CVE-2017-10067)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2017-10067&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;Title&#39;</span>: <span style="color:#e6db74">&#39;Java CPU July 2017 Java SE, Java SE Embedded vulnerability (CVE-2017-10074)&#39;</span>, <span style="color:#e6db74">&#39;ID&#39;</span>: <span style="color:#e6db74">&#39;jre-vuln-cve-2017-10074&#39;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>....
</span></span><span style="display:flex;"><span>....
</span></span><span style="display:flex;"><span>SNIP
</span></span><span style="display:flex;"><span>....
</span></span><span style="display:flex;"><span>....
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>user@rhost<span style="color:#f92672">]</span>$ python3 nexposeScan.py 10.99.55.129 10.6.55.152
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;10.99.55.129&#39;</span>, <span style="color:#e6db74">&#39;10.6.55.152&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>addIpToNexposeSite
</span></span></code></pre></div>
        </div>
        

    


<div class="post-info">
    
        <div class="post-date dt-published">2020-10-20</div>
    

    <a class="post-hidden-url u-url" href="https://www.cihatyildiz.com/post/2020-10-20-vulnerability-scan-by-using-api/">https://www.cihatyildiz.com/post/2020-10-20-vulnerability-scan-by-using-api/</a>
    <a href="https://www.cihatyildiz.com" class="p-name p-author post-hidden-author h-card" rel="me">Cihat Yildiz</a>


    <div class="post-taxonomies">
        
            <ul class="post-categories">
                
                    
                    <li><a href="https://www.cihatyildiz.com/categories/vulnerability/">vulnerability</a></li>
                
            </ul>
            
            
                <ul class="post-tags">
                    
                        
                        <li><a href="https://www.cihatyildiz.com/tags/api/">#api</a></li>
                    
                        
                        <li><a href="https://www.cihatyildiz.com/tags/scanning/">#scanning</a></li>
                    
                </ul>
        
    </div>
</div>

    </article>

    
        
    <div class="pagination post-pagination">
        <div class="left pagination-item ">
            
                <a href="/post/2020-12-01-hack-the-box-lame/">Writeup - Hack The Box - Lame</a>
            
        </div>
        <div class="right pagination-item ">
            
                <a href="/post/2020-10-01-a-cheatsheet-for-docker/">A Cheatsheet for Docker</a>
            
        </div>
    </div>




    

    

    

    


        </main>
        
            <footer class="common-footer">
    
    

    <div class="common-footer-bottom">
        
        <div class="copyright">
            <p> Cihat Yildiz, 2022<br>
            Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/mitrichius/hugo-theme-anubis">Anubis</a>.<br>
            
            </p>  
        </div> 

        

    



    <button class="theme-switcher">
        Dark theme
    </button>

    <script>
    const STORAGE_KEY = 'user-color-scheme'
    const defaultTheme = "auto"

    let currentTheme
    let switchButton
    let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

    const autoChangeScheme = e => {
        currentTheme = e.matches ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', currentTheme)
        changeButtonText()
    }

    document.addEventListener('DOMContentLoaded', function() {
        switchButton = document.querySelector('.theme-switcher')
        currentTheme = detectCurrentScheme()
        if (currentTheme == 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark')
        }
        if (currentTheme == 'auto') {
            autoChangeScheme(autoDefinedScheme);
            autoDefinedScheme.addListener(autoChangeScheme);
        }
        changeButtonText()
        switchButton.addEventListener('click', switchTheme, false)
    })

    function detectCurrentScheme() {
        if (localStorage.getItem(STORAGE_KEY)) {
            return localStorage.getItem(STORAGE_KEY)
        } 
        if (defaultTheme) {
            return defaultTheme
        } 
        if (!window.matchMedia) {
            return 'light'
        } 
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'dark'
        }
        return 'light'
    }

    function changeButtonText()
    {   
        switchButton.textContent = currentTheme == 'dark' ?  "Light theme" : "Dark theme"
    }

    function switchTheme(e) {
        if (currentTheme == 'dark') {
            localStorage.setItem(STORAGE_KEY, 'light')
            document.documentElement.setAttribute('data-theme', 'light')
            currentTheme = 'light'
        } else {
            localStorage.setItem(STORAGE_KEY, 'dark')
            document.documentElement.setAttribute('data-theme', 'dark')
            currentTheme = 'dark'
        }
        changeButtonText()
    }
    </script>
   
    </div>

    <p class="h-card vcard">

    <a href=https://www.cihatyildiz.com class="p-name u-url url fn" rel="me">Cihat Yildiz</a> 

    

    
</p> 
</footer>

        
    </div>
</body>
</html>
