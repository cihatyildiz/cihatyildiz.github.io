<!DOCTYPE html>



<html lang="en-US" 
  
    mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Useful SQL Queries for Nexpose" />
<meta name="author" content="Cihat Yildiz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Nexpose has lots of features to generate reports. But in some cases, the features in the UI may not be useful for you. You may need to create custom reports for your vulnerability management process. Also, you may need to generate a custom data related to your organization. For this purpose, nexpose allow you to access to its database by using SQL report template. Wit this feature you can run a SQL query in the database and get the data you want." />
<meta property="og:description" content="Nexpose has lots of features to generate reports. But in some cases, the features in the UI may not be useful for you. You may need to create custom reports for your vulnerability management process. Also, you may need to generate a custom data related to your organization. For this purpose, nexpose allow you to access to its database by using SQL report template. Wit this feature you can run a SQL query in the database and get the data you want." />
<link rel="canonical" href="www.cihatyildiz.com/posts/useful-sql-queries-for-nexpose/" />
<meta property="og:url" content="www.cihatyildiz.com/posts/useful-sql-queries-for-nexpose/" />
<meta property="og:site_name" content="Cihat Yildiz" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-30T20:55:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Useful SQL Queries for Nexpose" />
<meta name="twitter:site" content="@cihatix" />
<meta name="twitter:creator" content="@Cihat Yildiz" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"datePublished":"2020-08-30T20:55:00+08:00","description":"Nexpose has lots of features to generate reports. But in some cases, the features in the UI may not be useful for you. You may need to create custom reports for your vulnerability management process. Also, you may need to generate a custom data related to your organization. For this purpose, nexpose allow you to access to its database by using SQL report template. Wit this feature you can run a SQL query in the database and get the data you want.","mainEntityOfPage":{"@type":"WebPage","@id":"www.cihatyildiz.com/posts/useful-sql-queries-for-nexpose/"},"url":"www.cihatyildiz.com/posts/useful-sql-queries-for-nexpose/","author":{"@type":"Person","name":"Cihat Yildiz"},"headline":"Useful SQL Queries for Nexpose","dateModified":"2020-08-30T20:55:00+08:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Useful SQL Queries for Nexpose | Cihat Yildiz
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Cihat Yildiz">
<meta name="application-name" content="Cihat Yildiz">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  



  <!-- image lazy-loading & popup -->
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>






</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/salyangoz.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Cihat Yildiz</a>
    </div>

    <div class="site-subtitle font-italic">cybersecurity, etc.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/cihatyildiz" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/cihatix" aria-label="twitter"
        
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['cihat.yildiz','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span>Useful SQL Queries for Nexpose</span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Useful SQL Queries for Nexpose</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            Cihat Yildiz
          </span>
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Sun, Aug 30, 2020,  8:55 PM +0800"
  

  
  prep="on" >

  
  

  
    Aug 30, 2020
  

  <i class="unloaded">2020-08-30T20:55:00+08:00</i>

</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="645 words">3 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>Nexpose has lots of features to generate reports. But in some cases, the features in the UI may not be useful for you. You may need to create custom reports for your vulnerability management process. Also, you may need to generate a custom data related to your organization. For this purpose, nexpose allow you to access to its database  by using SQL report template. Wit this feature you can run a SQL query in the database and get the data you want.</p>

<p>In this post, I want to share some SQL query examples that you can use in nexpose. The SQL examples here are the ones I tested on my nexpose infrastructure. I also provided the nexpose database scheme below. You can generate your own queries. The sky is the limit :). So, you can review the database schema and create your own query. If you dont know hhow to generate SQL query, you can reach out to Rapid7 support and request a SQL query based on your needs.</p>

<ul>
  <li><a href="https://help.rapid7.com/nexpose/en-us/warehouse/warehouse-schema.html">Nexpose Warehohuse Schema</a></li>
</ul>

<h1 id="authennticated-scan-percentage">Authennticated scan percentage</h1>

<p>This shows the authenticated scan percentage. This is a useful query for scan health.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="k">WITH</span>
<span class="n">CTE</span> <span class="k">AS</span> <span class="p">(</span>
<span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="k">ON</span> <span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>    
     <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">da</span><span class="p">.</span><span class="n">host_name</span><span class="p">,</span> <span class="n">dos</span><span class="p">.</span><span class="n">description</span> <span class="k">AS</span> <span class="n">operating_system</span><span class="p">,</span>     
     <span class="n">fa</span><span class="p">.</span><span class="n">scan_finished</span> <span class="k">AS</span> <span class="n">last_scanned</span><span class="p">,</span> <span class="n">aos</span><span class="p">.</span><span class="n">certainty</span><span class="p">,</span><span class="n">aos</span><span class="p">.</span><span class="n">fingerprint_source_id</span><span class="p">,</span>
<span class="k">CASE</span>
<span class="k">WHEN</span> <span class="p">(</span><span class="n">aos</span><span class="p">.</span><span class="n">certainty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="k">sum</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">ELSE</span> <span class="k">sum</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">END</span> <span class="k">AS</span> <span class="n">authenticated</span><span class="p">,</span>

<span class="k">CASE</span>
<span class="k">WHEN</span> <span class="p">(</span><span class="n">aos</span><span class="p">.</span><span class="n">certainty</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="k">sum</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">ELSE</span> <span class="k">sum</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">END</span> <span class="k">AS</span> <span class="n">total</span>

   
<span class="k">FROM</span> <span class="n">fact_asset</span> <span class="k">AS</span> <span class="n">fa</span>    
   <span class="k">JOIN</span> <span class="n">dim_asset</span> <span class="n">da</span> <span class="k">USING</span> <span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>    
   <span class="k">JOIN</span> <span class="n">dim_operating_system</span> <span class="n">dos</span> <span class="k">USING</span> <span class="p">(</span><span class="n">operating_system_id</span><span class="p">)</span>    
   <span class="k">JOIN</span> <span class="n">dim_asset_operating_system</span> <span class="n">aos</span> <span class="k">USING</span> <span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>    
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">da</span><span class="p">.</span><span class="n">host_name</span><span class="p">,</span> <span class="n">dos</span><span class="p">.</span><span class="n">description</span><span class="p">,</span> <span class="n">fa</span><span class="p">.</span><span class="n">scan_finished</span><span class="p">,</span> <span class="n">aos</span><span class="p">.</span><span class="n">certainty</span><span class="p">,</span> <span class="n">aos</span><span class="p">.</span><span class="n">fingerprint_source_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span> <span class="k">ASC</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">authenticated</span><span class="p">)</span> <span class="k">as</span> <span class="n">authenticated</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">total</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">authenticated</span><span class="p">)</span><span class="o">/</span><span class="k">sum</span><span class="p">(</span><span class="n">total</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">percentage_authenticated</span>
<span class="k">FROM</span> <span class="n">CTE</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="duplicate-asset-information">Duplicate asset information</h1>

<p>You can see the how many duplicate assets in nexpose</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">da</span><span class="p">.</span><span class="n">host_name</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">dim_asset</span> <span class="n">da</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">da</span><span class="p">.</span><span class="n">host_name</span>
<span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="vulnerabilities-with-proof-information">Vulnerabilities with proof information</h1>

<p>This query shows the proof information of the vulnnerabilities.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span> <span class="k">AS</span> <span class="nv">"IP Address"</span><span class="p">,</span> 
      <span class="n">da</span><span class="p">.</span><span class="n">host_name</span> <span class="k">AS</span> <span class="nv">"Host Name"</span><span class="p">,</span> 
      <span class="n">dv</span><span class="p">.</span><span class="n">title</span> <span class="k">AS</span> <span class="nv">" Vulnerability Title"</span><span class="p">,</span> 
      <span class="n">dv</span><span class="p">.</span><span class="n">description</span> <span class="k">AS</span> <span class="nv">"Vulnerability Description"</span><span class="p">,</span> 
      <span class="n">fa</span><span class="p">.</span><span class="n">proof</span> <span class="k">AS</span> <span class="nv">"Proof"</span><span class="p">,</span> 
      <span class="n">fa</span><span class="p">.</span><span class="k">key</span> <span class="k">AS</span> <span class="nv">"Proof Key"</span><span class="p">,</span> 
      <span class="n">da</span><span class="p">.</span><span class="n">sites</span> <span class="k">AS</span> <span class="n">Sites</span><span class="p">,</span> 
      <span class="n">dv</span><span class="p">.</span><span class="n">nexpose_id</span> <span class="k">AS</span> <span class="nv">"NexposeID"</span>
<span class="k">FROM</span> <span class="n">fact_asset_vulnerability_instance</span> <span class="n">fa</span> 
<span class="k">JOIN</span> <span class="n">dim_asset</span> <span class="n">da</span> <span class="k">USING</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span> 
<span class="k">JOIN</span> <span class="n">dim_vulnerability</span> <span class="n">dv</span> <span class="k">USING</span><span class="p">(</span><span class="n">vulnerability_id</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="shares-on-assets">Shares on Assets</h1>

<p>Withh this query you can use SMB shares on your assets</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">da</span><span class="p">.</span><span class="n">host_name</span><span class="p">,</span> <span class="n">dos</span><span class="p">.</span><span class="n">description</span><span class="p">,</span> <span class="n">daf</span><span class="p">.</span><span class="k">type</span><span class="p">,</span> <span class="n">daf</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">da</span><span class="p">.</span><span class="n">sites</span>
<span class="k">from</span> <span class="n">dim_asset</span> <span class="n">da</span>
   <span class="k">JOIN</span> <span class="n">dim_asset_file</span> <span class="n">daf</span> <span class="k">using</span> <span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
   <span class="k">JOIN</span> <span class="n">dim_operating_system</span> <span class="n">dos</span> <span class="k">USING</span> <span class="p">(</span><span class="n">operating_system_id</span><span class="p">)</span>  
<span class="k">order</span> <span class="k">by</span> <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span> <span class="k">asc</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="daily-new-vulns">Daily New Vulns</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="k">WITH</span>
   <span class="n">today_date</span> <span class="k">AS</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="n">now</span><span class="p">()</span> <span class="k">AS</span> <span class="nb">date</span>
   <span class="p">),</span>
   <span class="n">asset_scans</span> <span class="k">AS</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="n">asset_id</span><span class="p">,</span> <span class="n">scanAsOfDate</span><span class="p">(</span><span class="n">asset_id</span><span class="p">,</span> <span class="n">now</span><span class="p">()::</span><span class="nb">date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">scan_today</span><span class="p">,</span> <span class="n">scanAsOfDate</span><span class="p">(</span><span class="n">asset_id</span><span class="p">,</span> <span class="p">((</span><span class="k">SELECT</span> <span class="nb">date</span> <span class="k">FROM</span> <span class="n">today_date</span><span class="p">)</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'1 day'</span><span class="p">)::</span><span class="nb">date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">scan_day_ago</span>
      <span class="k">FROM</span> <span class="n">dim_asset</span>
   <span class="p">),</span>
   <span class="n">asset_scan_results</span> <span class="k">AS</span> <span class="p">(</span>
      <span class="c1">-- results from the scan on each asset for today's results</span>
      <span class="k">SELECT</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">asset_id</span><span class="p">,</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">vulnerability_id</span><span class="p">,</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">scan_id</span><span class="p">,</span> <span class="mi">2</span> <span class="k">AS</span> <span class="k">state</span>
      <span class="k">FROM</span> <span class="n">fact_asset_scan_vulnerability_finding</span> <span class="n">fasvf</span>
         <span class="k">JOIN</span> <span class="n">asset_scans</span> <span class="n">a</span> <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">asset_id</span> <span class="o">=</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">asset_id</span> <span class="k">AND</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">scan_id</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">scan_today</span>
      <span class="k">UNION</span> <span class="k">ALL</span>
      <span class="c1">-- results from the scan on each asset for the results one day ago</span>
      <span class="k">SELECT</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">asset_id</span><span class="p">,</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">vulnerability_id</span><span class="p">,</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">scan_id</span><span class="p">,</span> <span class="mi">1</span> <span class="k">AS</span> <span class="k">state</span>
      <span class="k">FROM</span> <span class="n">fact_asset_scan_vulnerability_finding</span> <span class="n">fasvf</span>
         <span class="k">JOIN</span> <span class="n">asset_scans</span> <span class="n">a</span> <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">asset_id</span> <span class="o">=</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">asset_id</span> <span class="k">AND</span> <span class="n">fasvf</span><span class="p">.</span><span class="n">scan_id</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">scan_day_ago</span>
   <span class="p">),</span>
   <span class="n">asset_scan_results_diff</span> <span class="k">AS</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="n">asset_id</span><span class="p">,</span> <span class="n">vulnerability_id</span><span class="p">,</span> <span class="n">baselineComparison</span><span class="p">(</span><span class="k">state</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">diff</span>
      <span class="k">FROM</span> <span class="n">asset_scan_results</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">asset_id</span><span class="p">,</span> <span class="n">vulnerability_id</span>
   <span class="p">)</span>
<span class="k">SELECT</span> <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">da</span><span class="p">.</span><span class="n">host_name</span><span class="p">,</span> <span class="n">da</span><span class="p">.</span><span class="n">mac_address</span><span class="p">,</span> <span class="n">asrd</span><span class="p">.</span><span class="n">diff</span><span class="p">,</span> <span class="n">dv</span><span class="p">.</span><span class="n">title</span> <span class="k">AS</span> <span class="n">vulnerability_title</span><span class="p">,</span> <span class="n">to_char</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span> <span class="s1">'YYYY-mm-dd'</span><span class="p">)</span> <span class="k">AS</span> <span class="k">current_date</span>
<span class="k">FROM</span> <span class="n">asset_scan_results_diff</span> <span class="n">asrd</span>
   <span class="k">JOIN</span> <span class="n">dim_asset</span> <span class="n">da</span> <span class="k">USING</span> <span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>
   <span class="k">JOIN</span> <span class="n">dim_vulnerability</span> <span class="n">dv</span> <span class="k">USING</span> <span class="p">(</span><span class="n">vulnerability_id</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">asrd</span><span class="p">.</span><span class="n">diff</span> <span class="o">=</span> <span class="s1">'New'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">da</span><span class="p">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">asrd</span><span class="p">.</span><span class="n">diff</span><span class="p">,</span> <span class="n">dv</span><span class="p">.</span><span class="n">title</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="recources">Recources</h1>

<ul>
  <li><a href="https://github.com/blak3irwin/nexpose-sql-queries">Nexpose SQL queries-black3irwin</a></li>
  <li><a href="https://github.com/rapid7/nexpose-resources">Nexpose Resources - rapid7</a></li>
  <li><a href="https://docs.rapid7.com/nexpose/sql-query-export-examples/">SQL Query Export examples - rapid7</a></li>
  <li><a href="https://github.com/talltechy/InsightVM-SQL-Queries-Reports">InsightVM-SQL-Queries-Reports</a></li>
  <li><a href="https://github.com/BrianWGray/cmty-nexpose-checks/wiki/Understanding-Fingerprints-and-Vulnerability-Checks">Understanding Fingerprints and Vulnerability Checks</a></li>
</ul>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/nexpose/'>Nexpose</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/writing/"
            class="post-tag no-text-decoration" >writing</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Useful SQL Queries for Nexpose - Cihat Yildiz&url=www.cihatyildiz.com/posts/useful-sql-queries-for-nexpose/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Useful SQL Queries for Nexpose - Cihat Yildiz&u=www.cihatyildiz.com/posts/useful-sql-queries-for-nexpose/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=Useful SQL Queries for Nexpose - Cihat Yildiz&url=www.cihatyildiz.com/posts/useful-sql-queries-for-nexpose/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/a-cheatsheet-for-docker/">A Cheatsheet for Docker</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/writing/">writing</a>
      
        
        <a class="post-tag" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag" href="/tags/api/">api</a>
      
        
        <a class="post-tag" href="/tags/dba/">dba</a>
      
        
        <a class="post-tag" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag" href="/tags/http/">http</a>
      
        
        <a class="post-tag" href="/tags/scanning/">scanning</a>
      
        
        <a class="post-tag" href="/tags/web-security/">web security</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/some-re-tools/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Jan 14, 2020
  

  <i class="unloaded">2020-01-14T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Some Reverse Engineering Tools</h3>
            <div class="text-muted small">
              <p>
                





                Reverse engineering is analyzing an object, system or application to see how it works in order to understand the design and the behavior. If you are in the cybersecurity domain, you may use several...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/notes-about-improving-technical-writing/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Feb 14, 2020
  

  <i class="unloaded">2020-02-14T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Notes About Improving Technical Writing</h3>
            <div class="text-muted small">
              <p>
                





                We read and write a number of documents related to different topics every day. And, sometimes we want to create a better structure in our technical documents. Sometimes, we want to use better struc...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/an-api-for-secret-scanning/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Sep 24, 2020
  

  <i class="unloaded">2020-09-24T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Simple API for Secret Scanning</h3>
            <div class="text-muted small">
              <p>
                





                Secret scanning is an essential process before application deployment. You need to check any information left in the code, such as password, keys, etc. There are many tools to identify secrets. Whi...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/database-security-basics/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Database Security Notes</p>
  </a>
  

  
  <a href="/posts/an-api-for-secret-scanning/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Simple API for Secret Scanning</p>
  </a>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="https://twitter.com/cihatix">Cihat Yildiz</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/writing/">writing</a>
      
        
        <a class="post-tag" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag" href="/tags/api/">api</a>
      
        
        <a class="post-tag" href="/tags/dba/">dba</a>
      
        
        <a class="post-tag" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag" href="/tags/http/">http</a>
      
        
        <a class="post-tag" href="/tags/scanning/">scanning</a>
      
        
        <a class="post-tag" href="/tags/web-security/">web security</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="www.cihatyildiz.com{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

