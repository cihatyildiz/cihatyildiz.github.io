<!DOCTYPE html>



<html lang="en-US" 
  
    mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Win32 System Programming - Part 2" />
<meta name="author" content="Cihat Yildiz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Windows API Programlamaya İlişkin Temel Bilgiler" />
<meta property="og:description" content="Windows API Programlamaya İlişkin Temel Bilgiler" />
<link rel="canonical" href="www.cihatyildiz.com/posts/win32-system-prog-part2/" />
<meta property="og:url" content="www.cihatyildiz.com/posts/win32-system-prog-part2/" />
<meta property="og:site_name" content="Cihat Yildiz" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-09-08T20:55:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Win32 System Programming - Part 2" />
<meta name="twitter:site" content="@cihatix" />
<meta name="twitter:creator" content="@Cihat Yildiz" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"datePublished":"2014-09-08T20:55:00+08:00","description":"Windows API Programlamaya İlişkin Temel Bilgiler","mainEntityOfPage":{"@type":"WebPage","@id":"www.cihatyildiz.com/posts/win32-system-prog-part2/"},"url":"www.cihatyildiz.com/posts/win32-system-prog-part2/","author":{"@type":"Person","name":"Cihat Yildiz"},"headline":"Win32 System Programming - Part 2","dateModified":"2014-09-08T20:55:00+08:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Win32 System Programming - Part 2 | Cihat Yildiz
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Cihat Yildiz">
<meta name="application-name" content="Cihat Yildiz">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  



  <!-- image lazy-loading & popup -->
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>






</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/salyangoz.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Cihat Yildiz</a>
    </div>

    <div class="site-subtitle font-italic">cybersecurity, etc.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/cihatyildiz" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/cihatix" aria-label="twitter"
        
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['cihat.yildiz','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span>Win32 System Programming - Part 2</span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Win32 System Programming - Part 2</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            Cihat Yildiz
          </span>
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Mon, Sep  8, 2014,  8:55 PM +0800"
  

  
  prep="on" >

  
  

  
    Sep  8, 2014
  

  <i class="unloaded">2014-09-08T20:55:00+08:00</i>

</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1930 words">10 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <h2 id="windows-api-programlamaya-i̇lişkin-temel-bilgiler">Windows API Programlamaya İlişkin Temel Bilgiler</h2>

<p>Windows API programlama yaparken kaynak kodun içerisine windows.h dosyasi include edilmelidir. Bu dosya içerisinde içerisinde gereken pekçok bildirim vardir. Sistem programlamada yazim stili olarak macar notasyonu (hungarian notation) kullanilir. Macar notasyonuna göre;</p>

<ul>
  <li>Fonksiyonlar pascal tarzı harflendirilir. Yani her sözcüğün ilk harfi büyüktür. (her sozcugun ilk harfi buyuktur. Fiiller ince kullanilir.)</li>
  <li>o GetWindowLong(), CreateProcess()</li>
  <li>Degiskenler genellikle onun turunu belirten bir önek ile başlatılır. Degişkenler deve notasyonu ile isimlendirilir. (camel notation)</li>
  <li>BYTE, WORD ve DWORD typedef isimleri sırasiyla 1, 2 ve 4 byte lik işaretsiz tam sayı türlerini temsil eder.</li>
  <li>Typedef isimlerindeki P öneki ve LP öneki gösterici anlamına gelir. (Windows 3.x sistemlerinde farkli anlama gelmektedir.)</li>
  <li>Word kavramı donanım ve yazılımda farklıdırlar. Yazılımda 2 byte, ama donanimda register uzunlugu olarak adlandirilirlar.</li>
  <li>Gösterdigi yer const olan const göstericilerde PC veya LPC öneki kullanılır.</li>
  <li>Yazi türleri (char türden göstericiler) SZ yada LPSZ ile baslatilir.</li>
  <li>PSTR, LPSTR, LPCSTR yazıyı gösteren gösterici anlamındadır.</li>
  <li>BOOL türü başarı ve başarısızlığı anlatan bir türdür. INT olarak typedef edilmistir. ( 0 basarisiz, 0 disi basarisiz)</li>
  <li>fonksiyon tanimlarinda in, ”in_out”, ve “__out” ifadeleri sirasiyla ver kullanayim, ver icini ben de doldurayim ve ver icicin doldurayim manasinda kullanilir. CreateProcess() fonksiyonunun msdn icerisindeki dokumani icerisinde gorulebilir.</li>
  <li>kaanaslan.com makale id 49 incele</li>
</ul>

<p>Not : foldoc.org Güzel bir web sitesi. Online sözlük.</p>

<h3 id="unicode_kullanimi">unicode_kullanimi</h3>

<ul>
  <li>www.unicode.org</li>
  <li>java ve c# da char turu 2 byte tutar. C de ise 1 byte dir.</li>
  <li>typedef unsigned short wchart;</li>
  <li>32 bi windows sistemlerine gecildiginde unicode kullanimi da devreye girmistir. Butun yazi parametresi alan fonksiyonlardan aslinda 2 tane bulunmektedir. Sonu A ile birenler ASCII sonu W ile bitenler UNICODE anlamina gelmektedir.</li>
  <li>Biz program yazarken genellikle A ve W olmayan isimleri kullaniriz bu isimler duruma gore A ve W lu bicime donusturulurler.</li>
  <li>IDE de bu ayar proje seceneklerinden yapilmaktadir ve default durum UNICODE bicimindedir.</li>
  <li>CreateProcessA (ascii)</li>
  <li>CreateProcessW (unicode)</li>
</ul>

<p>C de ascii string “xxxx” biciminde, unicode string L”xxxxx” biciminde yazilir. Eger programimizi ascci ile unicode arasinda istedigimiz zaman cevirebilecegimiz bicimde yazmak istiyorsak. Butun iki tirnaklari TEXT macrosu ile girmeliyor.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="cp">#ifdef UNICODE
#define TEXT() L##S
#else
#define TEXT(,) S
#endif
</span></pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Ayrica Standat C fonksiyonlarinin ascii ve unicode versiyonlari vardir. Bunlar arasinda otomatik gecis yapmak icin ozel makrolar kullanilmaktadir. Bu makrolar tchar.h dosyasi icerisinde.</li>
  <li>Aslinda standartlara gore printf fonksiyonunun ascii ismi printf unicode ismi wprintf dir. Windowsta “_tprintf” dersek bu ide deki ayara gore wprintf veya printf kullanir</li>
</ul>

<h3 id="handle-kavramı">HANDLE Kavramı</h3>

<ul>
  <li>BIr veri yapisina erismekte kullanilan anahtar degerlere handle denir.</li>
  <li>Handle genel olarak bir veri yapisina erismekte kullanilan tekil anahtar degerdir. Handle tipik olarak bir adres formunda bulunabuilir. Bir dizide index belirtiyor olabilir.</li>
  <li>Handle kullanan kisi onun ne anlam ifade ettigini bilmek zorunda degildir.</li>
  <li>Bir handle sisteminde tipik olarak handle sistemini yaratan bir fonksiyon bulunur. Bunlar tipik olarak CreateXxxxx veya OpenXxxx olarak adlandirilir</li>
  <li>Handle sistemini kullanan fonksiyonlar vardir. bunlara biz handle degerini veririz ve giris yaptiririz. Nihayet handle sistemini yok eden fonksiyonalr vardir. Bunlar CloseXxx veya DestroyXxxx olarak adlandirilir.</li>
</ul>

<h3 id="bir-processin-yaratilmasi">Bir Processin Yaratilmasi</h3>

<ul>
  <li>windows sistemlerinde bir process yaratmak icin CreateProcess api fonksiyonu kullanilir. Bu dosyayi ram a yukler. Process kontrol blogunu olusturur.</li>
  <li>Ayrica process yaratmak icin shellExecute isimli bir shell apisi de vardir. Fakat shellExecute base bir fonksiiyon degildir. Bu da createProcess fonksiyonunu cagirmaktadir.</li>
  <li>shellExecute base bir fonksiyon degil. Dosya iliskilerini de ayrica inceliyor.</li>
  <li>Kernel e en yakin process yaratma fonksiyonu createProcess fonksiyonudur.</li>
  <li>Process yaratildigi zaman process yaninda bir de thread yaratilir. dwCreationFlags</li>
  <li>CREATE_NEW_CONSOLE – console uygulamasinda yeni bir konsol yaratilmaz. Ancak bu parametre ile yaratilabilir.</li>
  <li>process ceration class ve priorty class da belirtilebilir.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre><span class="n">BOOL</span> <span class="n">WINAPI</span> <span class="nf">CreateProcess</span><span class="p">(</span>
    <span class="n">_In_opt_</span> <span class="n">LPCTSTR</span> <span class="n">lpApplicationName</span><span class="p">,</span>
    <span class="n">_Inout_opt_</span> <span class="n">LPTSTR</span> <span class="n">lpCommandLine</span><span class="p">,</span>
    <span class="n">_In_opt_</span> <span class="n">LPSECURITY_ATTRIBUTES</span> <span class="n">lpProcessAttributes</span><span class="p">,</span>
    <span class="n">_In_opt_</span> <span class="n">LPSECURITY_ATTRIBUTES</span> <span class="n">lpThreadAttributes</span><span class="p">,</span>
    <span class="n">_In_</span> <span class="n">BOOL</span> <span class="n">bInheritHandles</span><span class="p">,</span>
    <span class="n">_In_</span> <span class="n">DWORD</span> <span class="n">dwCreationFlags</span><span class="p">,</span>
    <span class="n">_In_opt_</span> <span class="n">LPVOID</span> <span class="n">lpEnvirUnordered</span> <span class="n">List</span> <span class="n">Itemonment</span><span class="p">,</span>
    <span class="n">_In_opt_</span> <span class="n">LPCTSTR</span> <span class="n">lpCurrentDirectory</span><span class="p">,</span>
    <span class="n">_In_</span> <span class="n">LPSTARTUPINFO</span> <span class="n">lpStartupInfo</span><span class="p">,</span>
    <span class="n">_Out_</span> <span class="n">LPPROCESS_INFORMATION</span> <span class="n">lpProcessInformation</span>
<span class="p">);</span>
<span class="cm">/*------------------------------------------------------------------------
-
    CreateProcess örneği
-------------------------------------------------------------------------
*/</span>

<span class="cm">/* Sample.c */</span>

<span class="cp">#include &lt;stdio.h&gt;;
#include &lt;stdlib.h&gt;;
#include &lt;Windows.H&gt;;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">STARTUPINFO</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STARTUPINFO</span><span class="p">)};</span>
    <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">cmdLine</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"Notepad.exe"</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">cmdLine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
                     <span class="n">CREATE_NEW_CONSOLE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Cannot create process!</span><span class="se">\n</span><span class="s">);</span><span class="err">
</span><span class="s">        exit(EXIT_FAILURE);</span><span class="err">
</span><span class="s">    }</span><span class="err">

</span><span class="s">    printf("</span><span class="n">Press</span> <span class="n">ENTER</span> <span class="n">to</span> <span class="n">exit</span><span class="s">");</span><span class="err">
</span><span class="s">    getchar();</span><span class="err">

</span><span class="s">    return 0;</span><span class="err">
</span><span class="s">}</span><span class="err">
</span></pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Malesef createProcess fonksiyonunun ikinci parametresi fonksiyon tarafindan guncellenmektedir. Yani fonksiyonu buraya birseyler yazip sonra orjinal yaziyi yeniden yuklemektedir. Halbuki C de stringler guncellenemez. Eger edilmeye calisilirsa exception olusur.</li>
  <li>butun cift tirnaklari TEXT makrosu ile vereceksin</li>
  <li>unicode uyumlu fonksiyonleri kullanacaksin</li>
  <li>Char yerine de TCHAR uyumlu olani kullanmakn gerekiyor</li>
  <li>tchar.h icersiinde TEXT() makrosu yerine “_T()” makrosu de kullanilarbilir. Tamamiyle ayni anlama gelmektedir.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="cm">/*-----------------------------------------------------------------------
    CreateProcess örneği (Bir console programı diğerine
    çalıştırırsa default olarak aynı console ekranını kullanır.
    CREATE_NEW_CONSOLE çalıştırılan uygulama için yeni
    bir console ekranınınm yaratılcağı anlamına gelir)
-------------------------------------------------------------------------*/</span>

<span class="cm">/* Sample.c */</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;Windows.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">STARTUPINFO</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STARTUPINFO</span><span class="p">)};</span>
    <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">cmdLine</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"E:</span><span class="se">\\</span><span class="s">Dropbox</span><span class="se">\\</span><span class="s">Test</span><span class="se">\\</span><span class="s">Debug</span><span class="se">\\</span><span class="s">Test.exe ali veli selami"</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">cmdLine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
                        <span class="n">CREATE_NEW_CONSOLE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Cannot create process!..</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Press ENTER to exit"</span><span class="p">);</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Test.c */</span>

<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Press ENTER to exit</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="unicode--ascii-uyumlu-kullanim">UNICODE / ASCII uyumlu kullanim</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre><span class="cm">/*--------------------------------------------------------------
    UNICODE / ASCII uyumlu kullanım
--------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">STARTUPINFO</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STARTUPINFO</span><span class="p">)};</span>
    <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span><span class="p">;</span>
    <span class="n">TCHAR</span> <span class="n">cmdLine</span><span class="p">[]</span> <span class="o">=</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"Notepad.exe"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">cmdLine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
                            <span class="n">CREATE_NEW_CONSOLE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">_ftprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"Cannot create process!..</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">_tprintf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Press ENTER to exit"</span><span class="p">));</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*---------------------------------------------------------------------------
    UNICODE / ASCII uyumlu kullanım 
    (TEXT makrosu yerine _T makrosu da kullanılabilir. UYARI: TEXT
    makrosu için Windows.h yeterlidir, _T makrosu için tchar.h gerekir)
----------------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">STARTUPINFO</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STARTUPINFO</span><span class="p">)};</span>
    <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span><span class="p">;</span>
    <span class="n">TCHAR</span> <span class="n">cmdLine</span><span class="p">[]</span> <span class="o">=</span> <span class="n">_T</span><span class="p">(</span><span class="s">"Notepad.exe"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">cmdLine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
                        <span class="n">CREATE_NEW_CONSOLE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">_ftprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">_T</span><span class="p">(</span><span class="s">"Cannot create process!..</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">_tprintf</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">"Press ENTER to exit"</span><span class="p">));</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="shell-execute">Shell Execute</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">HINSTANCE</span> <span class="nf">ShellExecute</span><span class="p">(</span>
  <span class="err">\</span><span class="n">_In</span><span class="err">\</span><span class="n">_opt</span><span class="err">\</span><span class="n">_</span>  <span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span>
  <span class="err">\</span><span class="n">_In</span><span class="err">\</span><span class="n">_opt</span><span class="err">\</span><span class="n">_</span>  <span class="n">LPCTSTR</span> <span class="n">lpOperation</span><span class="p">,</span>
  <span class="err">\</span><span class="n">_In</span><span class="err">\</span><span class="n">_</span>      <span class="n">LPCTSTR</span> <span class="n">lpFile</span><span class="p">,</span>
  <span class="err">\</span><span class="n">_In</span><span class="err">\</span><span class="n">_opt</span><span class="err">\</span><span class="n">_</span>  <span class="n">LPCTSTR</span> <span class="n">lpParameters</span><span class="p">,</span>
  <span class="err">\</span><span class="n">_In</span><span class="err">\</span><span class="n">_opt</span><span class="err">\</span><span class="n">_</span>  <span class="n">LPCTSTR</span> <span class="n">lpDirectory</span><span class="p">,</span>
  <span class="err">\</span><span class="n">_In</span><span class="err">\</span><span class="n">_</span>      <span class="n">INT</span> <span class="n">nShowCmd</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>ShellExecude ile open ile dosya acarken bu dosya ile iliskilendirilmis olan uygulama ile birlikte acar. doc dosyasi acilirsa word acar, png dosyasi ise goruntu editleme programi ile acar.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre><span class="cm">/*---------------------------------------------------------------
    ShellExecute örneği
---------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
#include &lt;Shellapi.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">DWORD</span><span class="p">)</span> <span class="n">ShellExecute</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"open"</span><span class="p">),</span> 
                                <span class="n">TEXT</span><span class="p">(</span><span class="s">"Notepad.exe"</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">SW_SHOW</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_ftprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"cannot execute!..</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">_tprintf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Preass ENTER to exit"</span><span class="p">));</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*------------------------------------------------------------
    ShellExecute örneği
    (ShellExecute dosya ilişkilendirmesine bakar.
     Arka planda zaten CreateProcess fonksiyonunu çağırır)
-------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
#include &lt;Shellapi.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">DWORD</span><span class="p">)</span> <span class="n">ShellExecute</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"open"</span><span class="p">),</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"Test.txt"</span><span class="p">),</span> 
                                <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">SW_SHOW</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_ftprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"cannot execute!..</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">_tprintf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Preass ENTER to exit"</span><span class="p">));</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Windows da API Fonksiyonlarinin Hata Kodlarinin Elde edilmesi</p>

<ul>
  <li>Bir api fonksiyonu basarisiz oldugunda onun neden basarisiz oldugunu getLastError fonksiyonu ile elde edebiliriz. Butun error kodlarin windows.h iceriosinde ERROR_XXX sebolik sabitleri ile define edilmistir.</li>
  <li>Error degerlerini yaziya donusturmak icin formatMessage fonksiyornu kullanilir.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="cm">/*----------------------------------------------------------------------
    GetLastError ve FormatMessage fonksiyonları
    (ExitSys bu fonksiyonları çağırarak programı sonlandırır)
-----------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
</span>
<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">STARTUPINFO</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STARTUPINFO</span><span class="p">)};</span>
    <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span><span class="p">;</span>
    <span class="n">TCHAR</span> <span class="n">cmdLine</span><span class="p">[]</span> <span class="o">=</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"xxxxx.exe"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">cmdLine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
                        <span class="n">CREATE_NEW_CONSOLE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">ExitSys</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"CreateProcess"</span><span class="p">),</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>

    <span class="n">_tprintf</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">"Press ENTER to exit"</span><span class="p">));</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span><span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">_ftprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"%s: %s"</span><span class="p">),</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="process-id-ve-hadle-degerleri">Process Id ve hadle degerleri</h3>

<ul>
  <li>process id uzerinden handle degerini elde edebilirsin.</li>
  <li>Prcesslerin ID degerleri sistem genelinde tekdir.Biz ID degerini verip handle degerini alabiliriz. Process kontrol bloguna erismekte kullanilan deger hendle degeridir.Dolayisiyla API fonksiyonlari bizden handle degerini istemektedir.</li>
</ul>

<h3 id="processlerin-sonlanmasi">Processlerin Sonlanmasi</h3>

<ul>
  <li>exit fonksiyonu ile process kendisini sonlandirir. exit standart bir C fonksiyonudur.</li>
  <li>Process her zaman bir api ile sonlandirilir. Exit fonksiyonu exitProcess fonksiyonunu cagirir.</li>
  <li>Bir process windowsda aslinda exitProcess api fonksiyonu ile sonlandirilir.</li>
  <li>C nin statndart exit fonksiyonu aslinda bu api fonksiyonunu cagirir.<code class="language-plaintext highlighter-rouge">VOID WINAPI ExitProcess( _In_ UINT uExitCode );</code></li>
  <li>Aslinda bir C programi calismasina main fonksiyonundan baslamaz. Derleyici tarafindan koda yerlestirilmis olan bir yeden baslar ve main fonksiyonu burdan cagirilir. Main bitince akis bu baslangic koduna geri doner. Iste burada Exit uygulanmistir.</li>
</ul>

<h3 id="processlerin-exit-kodlari">Processlerin Exit Kodlari</h3>

<ul>
  <li>Process sonlandiginde isletim sistemine bir exit kodu iletilir.</li>
  <li>C de main fonksiyonunu geri donus degeri int olmak zorundadir. main fonksiyonunu geri donus degeri exit fonksiyonuna arguman yapilir.</li>
  <li>Zombi proses incelenecek (windows da zombi process yok. )</li>
  <li>Proceslerin exit codui process kontrol blogunda saklanir. Dolayisi ile process sonlanip hadle da kapatilis ise artik biz processin exit kodunu alamayiz.</li>
  <li>Bir processin exit kodu GetExitCodeProcess api fonksiyonu ile alinir.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>BOOL WINAPI GetExitCodeProcess(
\_In\_ HANDLE hProcess,
\_Out\_ LPDWORD lpExitCode
);
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Calisan processlerin exit codlarini alamayiz. Almaya calisirsak getExitCodeProcess fonksiyonu 259 ozel degerine geri doner.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre><span class="cm">/*---------------------------------------------------------------------------
    Proseslerin exit kodlarının elde edilmesi
-----------------------------------------------------------------------------*/</span>

<span class="cm">/* Sample.c */</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
</span>
<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">STARTUPINFO</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STARTUPINFO</span><span class="p">)};</span>
    <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span><span class="p">;</span>
    <span class="n">TCHAR</span> <span class="n">cmdLine</span><span class="p">[]</span> <span class="o">=</span> <span class="n">_T</span><span class="p">(</span><span class="s">"E:</span><span class="se">\\</span><span class="s">Dropbox</span><span class="se">\\</span><span class="s">Test</span><span class="se">\\</span><span class="s">Debug</span><span class="se">\\</span><span class="s">Test.exe ali veli selami"</span><span class="p">);</span>
    <span class="n">DWORD</span> <span class="n">dwExitCode</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">cmdLine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
                        <span class="n">CREATE_NEW_CONSOLE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">ExitSys</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"CreateProcess"</span><span class="p">),</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>

    <span class="n">_tprintf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Press ENTER to continue..."</span><span class="p">));</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetExitCodeProcess</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwExitCode</span><span class="p">))</span>
        <span class="n">ExitSys</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"GetExitCodeProcess"</span><span class="p">),</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">dwExitCode</span> <span class="o">==</span> <span class="n">STILL_ACTIVE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_tprintf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Process still running...</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">_tprintf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Exit code: %lu</span><span class="se">\n</span><span class="s">"</span><span class="p">),</span> <span class="n">dwExitCode</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span>  <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> 
                        <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="n">_ftprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">"%s: %s"</span><span class="p">),</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Test.c */</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Press ENTER to exit</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">getchar</span><span class="p">();</span>

    <span class="n">exit</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/notes/'>Notes</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/writing/"
            class="post-tag no-text-decoration" >writing</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Win32 System Programming - Part 2 - Cihat Yildiz&url=www.cihatyildiz.com/posts/win32-system-prog-part2/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Win32 System Programming - Part 2 - Cihat Yildiz&u=www.cihatyildiz.com/posts/win32-system-prog-part2/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=Win32 System Programming - Part 2 - Cihat Yildiz&url=www.cihatyildiz.com/posts/win32-system-prog-part2/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/a-cheatsheet-for-docker/">A Cheatsheet for Docker</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/writing/">writing</a>
      
        
        <a class="post-tag" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag" href="/tags/api/">api</a>
      
        
        <a class="post-tag" href="/tags/dba/">dba</a>
      
        
        <a class="post-tag" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag" href="/tags/http/">http</a>
      
        
        <a class="post-tag" href="/tags/scanning/">scanning</a>
      
        
        <a class="post-tag" href="/tags/web-security/">web security</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/useful-sql-queries-for-nexpose/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Aug 30, 2020
  

  <i class="unloaded">2020-08-30T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Useful SQL Queries for Nexpose</h3>
            <div class="text-muted small">
              <p>
                





                Nexpose has lots of features to generate reports. But in some cases, the features in the UI may not be useful for you. You may need to create custom reports for your vulnerability management proces...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/create-secure-file-container/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Apr 11, 2017
  

  <i class="unloaded">2017-04-11T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Create an Encrypted File Container by Using Luks</h3>
            <div class="text-muted small">
              <p>
                





                1
#dd if=/dev/urandom of=/dosya/yolu/guvenlidosya bs=1M count=500


Eger kurumsal veya kendinize ait verileri sifreli bir alanda tutmak icin luks ile sifreli bir alan olusturup verilerinizi bu anda...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/phhpvirtualbox-on-ubunntu/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    May 28, 2017
  

  <i class="unloaded">2017-05-28T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using Virtualbox/phpVirtualbox on Ubuntu Server</h3>
            <div class="text-muted small">
              <p>
                





                Bu yazıda Ubuntu Server LTS üzerine Virtualbox sanallaştırma ortamı ve bu sanallaştırma ortamını web üzerinden yönetebilmek için geliştirilen phpVirtualbox sisteminin kurulumundan bahsedeceğiz.
Önc...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/win32-system-prog-part1/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Win32 System Programming - Part 1</p>
  </a>
  

  
  <a href="/posts/win32-system-prog-part3/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Win32 System Programming - Part 3</p>
  </a>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="https://twitter.com/cihatix">Cihat Yildiz</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/writing/">writing</a>
      
        
        <a class="post-tag" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag" href="/tags/api/">api</a>
      
        
        <a class="post-tag" href="/tags/dba/">dba</a>
      
        
        <a class="post-tag" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag" href="/tags/http/">http</a>
      
        
        <a class="post-tag" href="/tags/scanning/">scanning</a>
      
        
        <a class="post-tag" href="/tags/web-security/">web security</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="www.cihatyildiz.com{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

