<!DOCTYPE html>



<html lang="en-US" 
  
    mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Win32 System Programming - Part 3" />
<meta name="author" content="Cihat Yildiz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="VirtualBox da share mount etmek: 1 sudo mount -t vboxsf EDrive EDrive" />
<meta property="og:description" content="VirtualBox da share mount etmek: 1 sudo mount -t vboxsf EDrive EDrive" />
<link rel="canonical" href="www.cihatyildiz.com/posts/win32-system-prog-part3/" />
<meta property="og:url" content="www.cihatyildiz.com/posts/win32-system-prog-part3/" />
<meta property="og:site_name" content="Cihat Yildiz" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-09-15T20:55:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Win32 System Programming - Part 3" />
<meta name="twitter:site" content="@cihatix" />
<meta name="twitter:creator" content="@Cihat Yildiz" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"datePublished":"2014-09-15T20:55:00+08:00","description":"VirtualBox da share mount etmek: 1 sudo mount -t vboxsf EDrive EDrive","mainEntityOfPage":{"@type":"WebPage","@id":"www.cihatyildiz.com/posts/win32-system-prog-part3/"},"url":"www.cihatyildiz.com/posts/win32-system-prog-part3/","author":{"@type":"Person","name":"Cihat Yildiz"},"headline":"Win32 System Programming - Part 3","dateModified":"2014-09-15T20:55:00+08:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Win32 System Programming - Part 3 | Cihat Yildiz
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Cihat Yildiz">
<meta name="application-name" content="Cihat Yildiz">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  



  <!-- image lazy-loading & popup -->
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>






</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/salyangoz.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Cihat Yildiz</a>
    </div>

    <div class="site-subtitle font-italic">cybersecurity, etc.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/cihatyildiz" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/cihatix" aria-label="twitter"
        
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['cihat.yildiz','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span>Win32 System Programming - Part 3</span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Win32 System Programming - Part 3</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            Cihat Yildiz
          </span>
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Mon, Sep 15, 2014,  8:55 PM +0800"
  

  
  prep="on" >

  
  

  
    Sep 15, 2014
  

  <i class="unloaded">2014-09-15T20:55:00+08:00</i>

</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3367 words">18 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>VirtualBox da share mount etmek:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sudo mount -t vboxsf EDrive EDrive
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Unix ve linux sistemlerinde process yaratan tek bir fonksiyon vardir o da fork isimli fonksiyondur. pid_t fork(void)</li>
  <li>Fork processin ozdes kopyasindan cikartir. Fakat ust e alt processler arasinda artik bundan sonra hicbir iliski yoktur. Bunlarin gecmisleri aynidir. Ayni kod bolmune sahiptirler. Fakat artik bu kodun ayni bolumunu calistirmak zorunda degildirler.</li>
  <li>Yani fork fonksiyonuna tek bir proses akisi girer ancak iki process cikar.</li>
  <li>http://linux.die.net/man/2/fork Adresinden ayrintili bilgi edinilebilir.</li>
  <li>Fork fonksiyonundan ust process yaratmis oldugu alt processin ID degeri ile Alt process de 0 degeri ile cikar.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span> 
<span class="k">if</span><span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span><span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
   <span class="n">perror</span><span class="p">(</span><span class="s">"Fork"</span><span class="p">);</span>   <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">)</span>
 <span class="p">}</span> 
<span class="k">if</span><span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// child   </span>
    <span class="c1">/// Your code will be here.... </span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>UNIX ve Linux sstemlerinde bir programi calistiran bir grup exec fonksiyonu vardir. bu fonksiyonlar mevcut processin bellek alanini bosaltarak yeni bir programi yuklerler ve mevcut processi baska bir program gibi calistirirlar.</li>
  <li>Yani exec isleminden sonra process kontrol blogu degismez. Processin butun haklari ayni kalir.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="rouge-code"><pre><span class="cm">/*---------------------------------------------------------------
    UNIX/Linux sistemlerinde fork işlemi
-----------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">"fork"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"child</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"parent</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">printf</span><span class="p">(</span><span class="s">"ends..</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*-------------------------------------------------------------------
   UNIX/Linux sistemlerinde exec işlemleri
---------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">execl</span><span class="p">(</span><span class="s">"/bin/ls"</span><span class="p">,</span> <span class="s">"/bin/ls"</span><span class="p">,</span> <span class="s">"-l"</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">"execl"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">printf</span><span class="p">(</span><span class="s">"unreachable code!...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*-------------------------------------------------------------
    Tipik bir fork / exec kalıbı
---------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">"fork"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">execl</span><span class="p">(</span><span class="s">"/bin/ls"</span><span class="p">,</span> <span class="s">"/bin/ls"</span><span class="p">,</span> <span class="s">"-l"</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">"execl"</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="p">}</span>
    
    <span class="cm">/* only parent executes this code... */</span>
    
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="process-listesinin-elde-edilmesi">Process Listesinin Elde Edilmesi</h3>

<ul>
  <li>Windows da sistemdeki processlerin listesini alabilmek icin iki grup apiden faydalanilabilmektedir. Birincisi eski stil toolhelp apileridir. ikincisi yeni stil psapi isimli api grubudur. Bu fonksiyonlarla biz processlerin ID lerini elde ederiz IDleri handle degerlerine donusturebiliriz.
    <ul>
      <li>toolhelp</li>
      <li>psapi</li>
    </ul>
  </li>
  <li>Unix linux sistemlerde proc dosya sistemie bakilmasi gerekmektedir. /proc</li>
  <li>Unix/linux sistemlerinde prosess listesini veren standart fonksiyonlar yoktur. Bu nedenle ps komutunun bazi sistemlerde nasil yazildigi bilinmemektedir. Fakat modern unix turevi sistemler proc dosya sistemini desteklemektedir. Process listesi dogrudan proc dosya sisteminden alinabilir.</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="cm">/*-------------------------------------------------------------
    .NET'te proses listesinin elde edilmesi
---------------------------------------------------------------\*/</span>

<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">CSD</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">App</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">Process</span> <span class="n">proc</span> <span class="k">in</span> <span class="n">Process</span><span class="p">.</span><span class="nf">GetProcesses</span><span class="p">())</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="n">ProcessName</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Windows da tum processlerin listesinin elde edilmesi konusunda bazi problemler vardir. Ornegin 64 bit bir process de EnumProcesses fonksiyonu 32 bit processleri tam olarak elde edememekte 32 de 64 bit processleri tam olarak elde edememektedir. bu nedenle tum listeyi almak icin hem 32 hem 64 bit uygulama calistirilmasi gereklmektedir.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre></td><td class="rouge-code"><pre><span class="cm">/*------------------------------------------------------------------------
    Proses listesinin PSAPI fonksiyonlarıyla elde edilmesi
--------------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
#include &lt;Psapi.h&gt;
</span>
<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">pids</span><span class="p">[</span><span class="mi">8192</span><span class="p">];</span>
    <span class="n">DWORD</span> <span class="n">dwCount</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hProcess</span><span class="p">;</span>
    <span class="n">HMODULE</span> <span class="n">hMod</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">cbNeeded</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">szProcessName</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">]</span> <span class="o">=</span> <span class="s">"&lt;unknown&gt;"</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">EnumProcesses</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="mi">8192</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwCount</span><span class="p">))</span>
        <span class="n">ExitSys</span><span class="p">(</span><span class="s">"EnumProcesses"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dwCount</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">hProcess</span> <span class="o">=</span> <span class="n">OpenProcess</span><span class="p">(</span><span class="n">PROCESS_QUERY_INFORMATION</span><span class="o">|</span><span class="n">PROCESS_VM_READ</span><span class="p">,</span> 
                                            <span class="n">FALSE</span><span class="p">,</span> <span class="n">pids</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">EnumProcessModules</span><span class="p">(</span> <span class="n">hProcess</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hMod</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">hMod</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">cbNeeded</span><span class="p">))</span>
            <span class="n">GetModuleBaseName</span><span class="p">(</span> <span class="n">hProcess</span><span class="p">,</span> <span class="n">hMod</span><span class="p">,</span> <span class="n">szProcessName</span><span class="p">,</span>
                               <span class="k">sizeof</span><span class="p">(</span><span class="n">szProcessName</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">TCHAR</span><span class="p">)</span> <span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">szProcessName</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span>  <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> 
                        <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: %s"</span><span class="p">,</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="processlerin-calisma-dizinleri">Processlerin calisma dizinleri</h3>

<ul>
  <li>Her processin bir calisma dizini vardir. Calisma dizini goreli yol ifadelerinin (path name) cozulmesi icin kullanilir. Process calisirken calisma dizini degistirilebilir.</li>
  <li>Windows da process in calisma dizini process yaratilirken createProcess fonksiyonunda belirtirlir. Eger ilgili parametee NULL gecilirse alt processin calisma dizini ust proccess ile ayni olur.</li>
  <li>UNIX ve Linux Sistemlerinde process in calisma dizini Fork islemi sirasinda dogrudan ust processs den alinoir biz bu sistemlerde calistiracagimiz programin calisma dizinini belirlemek istiyorsak once bir kez fork yapariz. Alt process de henuz exec yapmadan calisma dizinini degistiririz. sonra exec yapariz.</li>
  <li>Kaan aslanin http://www.kaanaslan.com/resource/article/display_article.php?page=1&amp;id=79 adresindeki makale okunmali</li>
  <li>Bir processin calisma dizini get current directory fonksiyonu ile elde edilebilir.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">GetCurrentDirectory</span><span class="p">(</span>
 <span class="n">_In_</span>   <span class="n">DWORD</span> <span class="n">nBufferLength</span><span class="p">,</span>
 <span class="n">_Out_</span>  <span class="n">LPTSTR</span> <span class="n">lpBuffer</span> 
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>windowsda path olarak 260 karakterden fazla girilemez. Eger daha uzun path lere erisim saglamak istiyorsak o zaman bir yere kadar path degisimi yapilir ve sonra tekrar path degisimi yapilir. Cok uzun yollardabu yontem izlenmelidir. Processin calisma dizini degistirmek icin windows da SetCurrentDirectory api fonksiyonu kullanilir.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>BOOL WINAPI SetCurrentDirectory(
  \_In\_  LPCTSTR lpPathName
);
</pre></td></tr></tbody></table></code></div></div>

<p>UNIX / Linux sistemlerinde processin calisma dizini getcwd api fonksiyonu ile alinir. Processin calisma dizinini degistirmek icin de chdir fonksiyonu kullanilir.</p>

<ul>
  <li>UNIX / Linux sistemlerinde bir surucu kavrami yoktur. Ancak windows sistemlerinde bu kavram vardir.</li>
  <li>Windows cevre degiskenleri yolu ile her surucu icin ayri bir default calisma dizini tutmaktadir. Ayrica processine iliskin surucu aktif surucudur. Eger yol ifadesinde surucuden sonra bir ter bolu () isareti kullanimamissa bu gorev yol ifadesidir. Dolayisi ile processin calismadizininden itibaren yer belirtir.</li>
  <li>Ancak yol ifadesi surucu icerdigi halde ilk ters bolu () yu icermiyor ise (oldugu gibi) bizim gecerli dizinimiz, aktif surucunmuz ne olursa olsun belirtilen surucudeki default dizinden hareket edilerek yol cozulur.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="cm">/*---------------------------------------------------------------------
    Prosesin çalışma dizininin elde edilmesi
-----------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
#include &lt;Psapi.h&gt;
</span>
<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">GetCurrentDirectory</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetCurrentDirectory"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span>  <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> 
                        <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: %s"</span><span class="p">,</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="bir-komut-yorumlayicisinin-catisi">Bir komut yorumlayicisinin catisi</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
</pre></td><td class="rouge-code"><pre><span class="cm">/*-----------------------------------------------------
    Bir komut yorumlayıcının çatısı
-------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
#include &lt;Psapi.h&gt;
</span>
<span class="cm">/* Symbolic Constants */</span>

<span class="cp">#define MAX_CMD_LINE                1024
#define MAX_CMD_PARAMS                32
</span>
<span class="cm">/* Type Declarations */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">tagCMD</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">Proc</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">}</span> <span class="n">CMD</span><span class="p">;</span>

<span class="cm">/* Function Prototypes */</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">PrintSysErr</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">Parse</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">DirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ClsProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ChDirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ExitProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* Global Data Definitions */</span>

<span class="kt">char</span> <span class="n">g_cmd</span><span class="p">[</span><span class="n">MAX_CMD_LINE</span><span class="p">];</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">g_params</span><span class="p">[</span><span class="n">MAX_CMD_PARAMS</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">g_nparams</span><span class="p">;</span>
<span class="n">CMD</span> <span class="n">g_cmds</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">"dir"</span><span class="p">,</span> <span class="n">DirProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"cls"</span><span class="p">,</span> <span class="n">ClsProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"cd"</span><span class="p">,</span> <span class="n">ChDirProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"exit"</span><span class="p">,</span> <span class="n">ExitProc</span><span class="p">},</span>
    <span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Function Definitions */</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GetCurrentDirectory</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetCurrentDirectory"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s&gt;"</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
        <span class="n">gets</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">);</span>
        <span class="n">Parse</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Proc</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"'%s' is not recognized as an internal or external command, </span><span class="se">\n</span><span class="err">
</span><span class="s">                        operable program or batch file.</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">,</span> <span class="s">"quit"</span><span class="p">))</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
        
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Parse</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">param</span><span class="p">;</span>

    <span class="n">g_nparams</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">param</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">,</span> <span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="n">param</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">param</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">))</span>
        <span class="n">g_params</span><span class="p">[</span><span class="n">g_nparams</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">DirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"dir</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ClsProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"cls"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ChDirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GetCurrentDirectory</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetCurrentDirectory"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SetCurrentDirectory</span><span class="p">(</span><span class="n">g_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span>  <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> 
                        <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: %s"</span><span class="p">,</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">PrintSysErr</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span>  <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> 
                        <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="processlerin-cevre-degiskenleri">Processlerin Cevre Degiskenleri</h2>

<ul>
  <li>Cevre degiskenleri (Environment variables) anahtar deger ciftlerini tutan bir cesit sozluk tarzi veri yapisidir.</li>
  <li>Biz anahtari verdigimizde bize deger geri verilir.</li>
  <li>Processin bir degisken listesi vardir.</li>
  <li>Cevre degiskenleri cekirdek tarafindan genellikle process kontrol blogunda yada processin bellek alaninda tutulur. Yani process e ozgudur.</li>
  <li>Processin cevre degiskenleri windows da process yaratilirken createProcess api fnksiyonu ile belirlenir. Eger ilgili parametre NULL ecilirse alt processin cevre degisken takimi ust process ile ayni olur.</li>
  <li>UNIX / Linux sistemlerinde cevre degiskenleri fork islemi sirasinda ust processten tamamen kopyalanir. Fakat exec yaparken tipki windowsda oldugu gibi istege bagli olarak degistirilebilmektedir.</li>
  <li>Windows da bir cevre degiskeni degerini almak icin GetEnvironmentVarible Api fonksiyonu kullanilir.</li>
  <li>Windows sistemlwerde komut satirinda cevre degiskeni verip anahtar elde etmek icin %%, linux sistemlerde de $ kalibi kullanilir.</li>
  <li>Windows sistemlerde komut satirindda komt satiri cevre degikenine ekleme yapmak icin set c=y komutu kullanilir. UNIX/Linux sistemlrede export x = y komutu kullanilir.</li>
  <li>Windows sistemlerde yeni cevre degiskeni eklemek icin setEnvironmentVeriable fonksiyonu kullanilir.</li>
  <li>Processin tum cevre degiskenlerinin elde edilmesi gerekebilir bu islem GetEnvironmentStrings api fonksiyonu ile yapilmaktadir.</li>
  <li><a href="http://www.csystem.org/makaleler/proseslerin-%C3%A7evre-de%C4%9Fi%C5%9Fkenleri">http://www.csystem.org/makaleler/proseslerin-%C3%A7evre-de%C4%9Fi%C5%9Fkenleri</a> makalesi incelenmeli.</li>
</ul>

<p><strong>NOT:</strong> Bir sistem fonksiyonu cagirildigi zamanan stack uzerinde normal calismasi gerektigi gibi calisir ancak bir kernel fonksiyonu cagirilsa kernel fonksiyonu kullanilan stack yapisina guvenmedigi icin kendisi stack uzerindeki alani kernel icin guvenli bir alana kopyalar. Isi bittikte sonra geri stake donus yapar. NOT: Unix/Linux sistemlerinde bir cevre degiskenini elde etmek icin get env standart c fonksiyonu kullanilir. Process e yeni bir cevre degiskeni eklemek icin setenv fonksiyotnu kullanilir. Procesin tum cevre degislenini elde etmek icin environ global pointer i kullanilir.</p>

<ul>
  <li>Bir cevre degiskenini kaliciligini saglamak icin Unix ve Linx da shell processinin calistirdigi betiklerin icersinde set islemleri yapilabilir. Windows da benzer bicimde ayni islem denetim masasindan yapilmaktadir.</li>
  <li>Cevre degiskenrleri neden kullanilmaktadir?</li>
  <li>BaZEN PROGRAMLARDAKI cesitli ayarlarin hicbirsey yapilmadan kujllaicilar tarafindan degistirilmesi istenebilir. Ornegin bir data dosyasinin yerini programci bir cevre degiskeninden alabilir. Kullanici da o cevre degiskenini degistirerek data dosyasini istedigi yere yerlestirebilir.</li>
  <li>Bazi sistem fonksiyonlarida bazi sistem degiskenlerine bakmaktadir.</li>
  <li>Ornegin createProcess birinci parametresi null gecilirse ve ikinci parametresindeki dosya isminde hicbir ters bolu karakteri kullannilmamissa. ilgili exe dosyayi sirasiyla belirli yerlerde arar en sonunda PATH cevre degiskeni ile belirtilen dizinlerde tek tek arar.</li>
  <li>Windows isletim sistemlerinde cevre degiskenlerinin buyuk/kucuk harf duyarliligi yoktur. fakat unix ve linux sistemlerinde vardir.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
</pre></td><td class="rouge-code"><pre><span class="cm">/*------------------------------------------------------------------------
      Prosesin çevre değişkenleri
      (GetEnvPros ve SetEnvProc fonksiyonlarının yazımlarına bakınız)
------------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
#include &lt;Psapi.h&gt;
</span>
<span class="cm">/* Symbolic Constants */</span>

<span class="cp">#define MAX_CMD_LINE                1024
#define MAX_CMD_PARAMS                32
</span>
<span class="cm">/* Type Declarations */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">tagCMD</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">Proc</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">}</span> <span class="n">CMD</span><span class="p">;</span>

<span class="cm">/* Function Prototypes */</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">PrintSysErr</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">Parse</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">DirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ClsProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ChDirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">GetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">SetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ExitProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* Global Data Definitions */</span>

<span class="kt">char</span> <span class="n">g_cmd</span><span class="p">[</span><span class="n">MAX_CMD_LINE</span><span class="p">];</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">g_params</span><span class="p">[</span><span class="n">MAX_CMD_PARAMS</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">g_nparams</span><span class="p">;</span>
<span class="n">CMD</span> <span class="n">g_cmds</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">"dir"</span><span class="p">,</span> <span class="n">DirProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"cls"</span><span class="p">,</span> <span class="n">ClsProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"cd"</span><span class="p">,</span> <span class="n">ChDirProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"getenv"</span><span class="p">,</span> <span class="n">GetEnvProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"setenv"</span><span class="p">,</span> <span class="n">SetEnvProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"exit"</span><span class="p">,</span> <span class="n">ExitProc</span><span class="p">},</span>
    
    <span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Function Definitions */</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GetCurrentDirectory</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetCurrentDirectory"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s&gt;"</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
        <span class="n">gets</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">);</span>
        <span class="n">Parse</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Proc</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"'%s' is not recognized as an internal or external command, </span><span class="err">
</span><span class="s">                    operable program or batch file.</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">,</span> <span class="s">"quit"</span><span class="p">))</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
        
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Parse</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">param</span><span class="p">;</span>

    <span class="n">g_nparams</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">param</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">,</span> <span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="n">param</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">param</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">))</span>
        <span class="n">g_params</span><span class="p">[</span><span class="n">g_nparams</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">DirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"dir</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ClsProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"cls"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ChDirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GetCurrentDirectory</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetCurrentDirectory"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SetCurrentDirectory</span><span class="p">(</span><span class="n">g_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">GetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">envs</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">envs</span> <span class="o">=</span> <span class="n">GetEnvironmentStrings</span><span class="p">())</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetEnvironmentStrings"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>

        <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">envs</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">puts</span><span class="p">(</span><span class="n">envs</span><span class="p">);</span>
            <span class="n">envs</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">envs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments..</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="n">g_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">SetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"argument missing...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments..</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SetEnvironmentVariable</span><span class="p">(</span><span class="n">g_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">?</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span>  <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> 
                        <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: %s"</span><span class="p">,</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">PrintSysErr</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span>  <span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">,</span> 
                        <span class="n">dwLastError</span><span class="p">,</span>
                        <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> 
                        <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">NULL</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/*------------------------------------------------------------------------------
    UNIX/Linux sistemlerine prosesin tüm çevre
    değişkenlerinin yazdırılması
-------------------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="o">**</span><span class="n">environ</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">environ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*----------------------------------------------------------------------
    CreateProcess PATH çevre değişkenlerine bakmaktadır

    (RunProcess)
---------------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;tchar.h&gt;
#include &lt;Windows.h&gt;
#include &lt;Psapi.h&gt;
</span>
<span class="cm">/* Symbolic Constants */</span>

<span class="cp">#define MAX_CMD_LINE                1024
#define MAX_CMD_PARAMS                32
</span>
<span class="cm">/* Type Declarations */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">tagCMD</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">Proc</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">}</span> <span class="n">CMD</span><span class="p">;</span>

<span class="cm">/* Function Prototypes */</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">PrintSysErr</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">Parse</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">DirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ClsProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ChDirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">GetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">SetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">RunProcess</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ExitProc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* Global Data Definitions */</span>

<span class="kt">char</span> <span class="n">g_cmd</span><span class="p">[</span><span class="n">MAX_CMD_LINE</span><span class="p">];</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">g_params</span><span class="p">[</span><span class="n">MAX_CMD_PARAMS</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">g_nparams</span><span class="p">;</span>
<span class="n">CMD</span> <span class="n">g_cmds</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">"dir"</span><span class="p">,</span> <span class="n">DirProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"cls"</span><span class="p">,</span> <span class="n">ClsProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"cd"</span><span class="p">,</span> <span class="n">ChDirProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"getenv"</span><span class="p">,</span> <span class="n">GetEnvProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"setenv"</span><span class="p">,</span> <span class="n">SetEnvProc</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"exit"</span><span class="p">,</span> <span class="n">ExitProc</span><span class="p">},</span>
    
    <span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Function Definitions */</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GetCurrentDirectory</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetCurrentDirectory"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s&gt;"</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
        <span class="n">gets</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">);</span>
        <span class="n">Parse</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Proc</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">RunProcess</span><span class="p">();</span>
            <span class="c1">//printf("'%s' is not recognized as an internal or external command, operable program or batch file.\n\n", g_params[0]);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">,</span> <span class="s">"quit"</span><span class="p">))</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
        
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Parse</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">param</span><span class="p">;</span>

    <span class="n">g_nparams</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">param</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">g_cmd</span><span class="p">,</span> <span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="n">param</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">param</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">" </span><span class="se">\t</span><span class="s">"</span><span class="p">))</span>
        <span class="n">g_params</span><span class="p">[</span><span class="n">g_nparams</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">DirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"dir</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ClsProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"cls"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ChDirProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GetCurrentDirectory</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetCurrentDirectory"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SetCurrentDirectory</span><span class="p">(</span><span class="n">g_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">GetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">envs</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">envs</span> <span class="o">=</span> <span class="n">GetEnvironmentStrings</span><span class="p">())</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">ExitSys</span><span class="p">(</span><span class="s">"GetEnvironmentStrings"</span><span class="p">,</span> <span class="n">EXIT_FAILURE</span><span class="p">);</span>

        <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">envs</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">puts</span><span class="p">(</span><span class="n">envs</span><span class="p">);</span>
            <span class="n">envs</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">envs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments..</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="n">g_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">SetEnvProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"argument missing...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g_nparams</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"too many arguments..</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SetEnvironmentVariable</span><span class="p">(</span><span class="n">g_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g_nparams</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">?</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">RunProcess</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">STARTUPINFO</span> <span class="n">si</span> <span class="o">=</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STARTUPINFO</span><span class="p">)};</span>
    <span class="n">PROCESS_INFORMATION</span> <span class="n">pi</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">g_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">CREATE_NEW_CONSOLE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">si</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">PrintSysErr</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitProc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ExitSys</span><span class="p">(</span><span class="n">LPCTSTR</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span><span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">dwLastError</span><span class="p">,</span>
                    <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: %s"</span><span class="p">,</span> <span class="n">lpszMsg</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">PrintSysErr</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">dwLastError</span> <span class="o">=</span> <span class="n">GetLastError</span><span class="p">();</span>
    <span class="n">LPTSTR</span> <span class="n">lpszErr</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">FormatMessage</span><span class="p">(</span><span class="n">FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span class="o">|</span> <span class="n">FORMAT_MESSAGE_FROM_SYSTEM</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">dwLastError</span><span class="p">,</span>
                    <span class="n">MAKELANGID</span><span class="p">(</span><span class="n">LANG_NEUTRAL</span><span class="p">,</span> <span class="n">SUBLANG_DEFAULT</span><span class="p">),</span> <span class="p">(</span><span class="n">LPTSTR</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lpszErr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">lpszErr</span><span class="p">);</span>
        <span class="n">LocalFree</span><span class="p">(</span><span class="n">lpszErr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/notes/'>Notes</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/writing/"
            class="post-tag no-text-decoration" >writing</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Win32 System Programming - Part 3 - Cihat Yildiz&url=www.cihatyildiz.com/posts/win32-system-prog-part3/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Win32 System Programming - Part 3 - Cihat Yildiz&u=www.cihatyildiz.com/posts/win32-system-prog-part3/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=Win32 System Programming - Part 3 - Cihat Yildiz&url=www.cihatyildiz.com/posts/win32-system-prog-part3/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/writing/">writing</a>
      
        
        <a class="post-tag" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag" href="/tags/api/">api</a>
      
        
        <a class="post-tag" href="/tags/dba/">dba</a>
      
        
        <a class="post-tag" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag" href="/tags/http/">http</a>
      
        
        <a class="post-tag" href="/tags/scanning/">scanning</a>
      
        
        <a class="post-tag" href="/tags/web-security/">web security</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/useful-sql-queries-for-nexpose/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Aug 30, 2020
  

  <i class="unloaded">2020-08-30T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Useful SQL Queries for Nexpose</h3>
            <div class="text-muted small">
              <p>
                





                Nexpose has lots of features to generate reports. But in some cases, the features in the UI may not be useful for you. You may need to create custom reports for your vulnerability management proces...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/create-secure-file-container/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Apr 11, 2017
  

  <i class="unloaded">2017-04-11T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Create an Encrypted File Container by Using Luks</h3>
            <div class="text-muted small">
              <p>
                





                1
#dd if=/dev/urandom of=/dosya/yolu/guvenlidosya bs=1M count=500


Eger kurumsal veya kendinize ait verileri sifreli bir alanda tutmak icin luks ile sifreli bir alan olusturup verilerinizi bu anda...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/phhpvirtualbox-on-ubunntu/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    May 28, 2017
  

  <i class="unloaded">2017-05-28T20:55:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using Virtualbox/phpVirtualbox on Ubuntu Server</h3>
            <div class="text-muted small">
              <p>
                





                Bu yazıda Ubuntu Server LTS üzerine Virtualbox sanallaştırma ortamı ve bu sanallaştırma ortamını web üzerinden yönetebilmek için geliştirilen phpVirtualbox sisteminin kurulumundan bahsedeceğiz.
Önc...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/win32-system-prog-part2/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Win32 System Programming - Part 2</p>
  </a>
  

  
  <a href="/posts/win32-system-prog-part4/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Win32 System Programming - Part 4</p>
  </a>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="https://twitter.com/cihatix">Cihat Yildiz</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/writing/">writing</a>
      
        
        <a class="post-tag" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag" href="/tags/api/">api</a>
      
        
        <a class="post-tag" href="/tags/dba/">dba</a>
      
        
        <a class="post-tag" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag" href="/tags/http/">http</a>
      
        
        <a class="post-tag" href="/tags/scanning/">scanning</a>
      
        
        <a class="post-tag" href="/tags/web-security/">web security</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="www.cihatyildiz.com{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

